
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì—‘ì…€ ê¸°ë°˜ ì›ê°€ê´€ë¦¬ ì‹œìŠ¤í…œ - SCMS</title>
    <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1.5rem 2rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        }

        .header h1 {
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .header .subtitle {
            opacity: 0.9;
            font-size: 0.9rem;
            font-weight: 300;
        }

        .container {
            padding: 2rem;
            max-width: 1400px;
            margin: 0 auto;
        }

        /* íƒ­ ë„¤ë¹„ê²Œì´ì…˜ */
        .nav-tabs {
            display: flex;
            background: white;
            border-radius: 12px 12px 0 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .nav-tab {
            flex: 1;
            padding: 1rem 2rem;
            background: #f8f9fa;
            border: none;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .nav-tab.active {
            background: white;
            color: #3498db;
            border-bottom: 3px solid #3498db;
        }

        .nav-tab:hover {
            background: #e9ecef;
        }

        /* íƒ­ ì½˜í…ì¸  */
        .tab-content {
            background: white;
            border-radius: 0 0 12px 12px;
            box-shadow: 0 4px 25px rgba(0,0,0,0.08);
            min-height: 600px;
        }

        .tab-pane {
            display: none;
            padding: 2rem;
        }

        .tab-pane.active {
            display: block;
        }

        /* ì—…ë¡œë“œ ì˜ì—­ */
        .upload-zone {
            border: 3px dashed #3498db;
            border-radius: 12px;
            padding: 3rem 2rem;
            text-align: center;
            background: linear-gradient(135deg, #f8fcff 0%, #e3f2fd 100%);
            transition: all 0.3s ease;
            margin-bottom: 2rem;
        }

        .upload-zone.dragover {
            border-color: #2ecc71;
            background: linear-gradient(135deg, #f0fff4 0%, #e8f5e8 100%);
        }

        .upload-zone input[type="file"] {
            display: none;
        }

        .upload-btn {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            padding: 1rem 2rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 500;
            margin-top: 1rem;
            transition: all 0.3s ease;
        }

        .upload-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
        }

        /* ì§„í–‰ë¥  ë°” */
        .progress-container {
            margin: 1rem 0;
            display: none;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background-color: #ecf0f1;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #2ecc71);
            width: 0%;
            transition: width 0.3s ease;
        }

        /* ë¶„ë¥˜ í•„í„° */
        .filter-section {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .filter-select {
            padding: 0.5rem 1rem;
            border: 2px solid #e1e8ed;
            border-radius: 6px;
            background: white;
            font-size: 0.9rem;
        }

        .filter-select:focus {
            outline: none;
            border-color: #3498db;
        }

        /* ìš”ì•½ ì¹´ë“œ */
        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .summary-card {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            border-left: 4px solid;
            transition: transform 0.3s ease;
        }

        .summary-card:hover {
            transform: translateY(-3px);
        }

        .summary-card.total { border-left-color: #3498db; }
        .summary-card.average { border-left-color: #2ecc71; }
        .summary-card.count { border-left-color: #f39c12; }
        .summary-card.status { border-left-color: #e74c3c; }

        .summary-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .summary-label {
            color: #7f8c8d;
            font-size: 0.9rem;
        }

        /* ì°¨íŠ¸ ì˜ì—­ */
        .chart-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .chart-container {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        }

        .chart-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: #2c3e50;
        }

        .chart-canvas {
            position: relative;
            height: 250px;
        }

        /* ë°ì´í„° í…Œì´ë¸” */
        .table-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            overflow: hidden;
        }

        .table-header {
            background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%);
            color: white;
            padding: 1rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th,
        .data-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid #ecf0f1;
        }

        .data-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #2c3e50;
        }

        .data-table tr:hover {
            background: #f8f9fa;
        }

        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            white-space: nowrap;
        }

        .status-normal { background-color: #d4edda; color: #155724; }
        .status-warning { background-color: #fff3cd; color: #856404; }
        .status-danger { background-color: #f8d7da; color: #721c24; }

        /* ì•¡ì…˜ ë²„íŠ¼ */
        .action-buttons {
            display: flex;
            gap: 0.5rem;
        }

        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .btn-edit {
            background: #3498db;
            color: white;
        }

        .btn-delete {
            background: #e74c3c;
            color: white;
        }

        .btn-export {
            background: #2ecc71;
            color: white;
            padding: 0.75rem 1.5rem;
            font-weight: 500;
        }

        /* ì•Œë¦¼ */
        .alert {
            padding: 1rem 1.5rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            .chart-section {
                grid-template-columns: 1fr;
            }

            .summary-cards {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }

            .filter-section {
                flex-direction: column;
                align-items: stretch;
            }

            .nav-tabs {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ­ ê¸ˆí˜• ì›ê°€ê´€ë¦¬ ì‹œìŠ¤í…œ (SCMS)</h1>
        <div class="subtitle">Excel ê¸°ë°˜ í†µí•© ì›ê°€ê´€ë¦¬ ì†”ë£¨ì…˜ - ì—ì´ì¹˜ ì—ì´ ì—” í…Œí¬</div>
    </div>

    <div class="container">
        <!-- íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('upload')">
                ğŸ“Š ë°ì´í„° ì—…ë¡œë“œ
            </button>
            <button class="nav-tab" onclick="switchTab('dashboard')">
                ğŸ“ˆ ëŒ€ì‹œë³´ë“œ
            </button>
            <button class="nav-tab" onclick="switchTab('list')">
                ğŸ“‹ ë°ì´í„° ëª©ë¡
            </button>
        </div>

        <div class="tab-content">
            <!-- ë°ì´í„° ì—…ë¡œë“œ íƒ­ -->
            <div id="upload" class="tab-pane active">
                <h2 style="margin-bottom: 1.5rem;">ğŸ“¤ ì—‘ì…€ íŒŒì¼ ì—…ë¡œë“œ</h2>

                <div class="alert alert-info">
                    <span>â„¹ï¸</span>
                    <div>
                        <strong>ì—…ë¡œë“œ ê°€ëŠ¥í•œ íŒŒì¼:</strong> .xlsx, .xls íŒŒì¼<br>
                        <strong>í•„ìˆ˜ ì»¬ëŸ¼:</strong> ëŒ€ë¶„ë¥˜, ì¤‘ë¶„ë¥˜, ì†Œë¶„ë¥˜, ê¸ˆí˜•ëª…, ì›ê°€, ìƒíƒœ, ë“±ë¡ì¼
                    </div>
                </div>

                <div class="upload-zone" id="uploadZone">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸ“</div>
                    <h3>íŒŒì¼ì„ ì—¬ê¸°ì— ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì„ íƒí•˜ì„¸ìš”</h3>
                    <p style="color: #7f8c8d; margin-top: 0.5rem;">
                        Excel íŒŒì¼(.xlsx, .xls)ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤
                    </p>
                    <input type="file" id="fileInput" accept=".xlsx,.xls">
                    <button class="upload-btn" onclick="document.getElementById('fileInput').click()">
                        ğŸ“‚ íŒŒì¼ ì„ íƒí•˜ê¸°
                    </button>
                </div>

                <div class="progress-container" id="progressContainer">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                        <span>ì—…ë¡œë“œ ì§„í–‰ë¥ </span>
                        <span id="progressText">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                </div>

                <div id="uploadResult"></div>

                <!-- ìƒ˜í”Œ íŒŒì¼ ë‹¤ìš´ë¡œë“œ -->
                <div style="margin-top: 2rem; text-align: center;">
                    <button class="btn btn-export" onclick="downloadSample()">
                        ğŸ“¥ ìƒ˜í”Œ íŒŒì¼ ë‹¤ìš´ë¡œë“œ
                    </button>
                </div>
            </div>

            <!-- ëŒ€ì‹œë³´ë“œ íƒ­ -->
            <div id="dashboard" class="tab-pane">
                <h2 style="margin-bottom: 1.5rem;">ğŸ“Š ì›ê°€ ë¶„ì„ ëŒ€ì‹œë³´ë“œ</h2>

                <!-- ë¶„ë¥˜ í•„í„° -->
                <div class="filter-section">
                    <div class="filter-group">
                        <label>ëŒ€ë¶„ë¥˜:</label>
                        <select class="filter-select" id="majorFilter" onchange="updateFilters()">
                            <option value="">ì „ì²´</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>ì¤‘ë¶„ë¥˜:</label>
                        <select class="filter-select" id="middleFilter" onchange="updateFilters()">
                            <option value="">ì „ì²´</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>ì†Œë¶„ë¥˜:</label>
                        <select class="filter-select" id="minorFilter" onchange="updateFilters()">
                            <option value="">ì „ì²´</option>
                        </select>
                    </div>
                    <button class="btn btn-export" onclick="exportFilteredData()">
                        ğŸ’¾ í˜„ì¬ ë°ì´í„° ë‚´ë³´ë‚´ê¸°
                    </button>
                </div>

                <!-- ìš”ì•½ ì¹´ë“œ -->
                <div class="summary-cards">
                    <div class="summary-card total">
                        <div class="summary-value" id="totalCost">â‚©0</div>
                        <div class="summary-label">ì´ ì›ê°€</div>
                    </div>
                    <div class="summary-card average">
                        <div class="summary-value" id="avgCost">â‚©0</div>
                        <div class="summary-label">í‰ê·  ì›ê°€</div>
                    </div>
                    <div class="summary-card count">
                        <div class="summary-value" id="totalCount">0ê±´</div>
                        <div class="summary-label">ì´ ë°ì´í„° ìˆ˜</div>
                    </div>
                    <div class="summary-card status">
                        <div class="summary-value" id="statusCount">0ê±´</div>
                        <div class="summary-label">ê²€í†  í•„ìš”</div>
                    </div>
                </div>

                <!-- ì°¨íŠ¸ ì˜ì—­ -->
                <div class="chart-section">
                    <div class="chart-container">
                        <div class="chart-title">ğŸ“Š ë¶„ë¥˜ë³„ ì›ê°€ ë¶„í¬</div>
                        <div class="chart-canvas">
                            <canvas id="categoryChart"></canvas>
                        </div>
                    </div>
                    <div class="chart-container">
                        <div class="chart-title">ğŸ“ˆ ì›ê°€ íŠ¸ë Œë“œ</div>
                        <div class="chart-canvas">
                            <canvas id="trendChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ë°ì´í„° ëª©ë¡ íƒ­ -->
            <div id="list" class="tab-pane">
                <div class="table-container">
                    <div class="table-header">
                        <h2>ğŸ“‹ ì›ê°€ ë°ì´í„° ëª©ë¡</h2>
                        <div style="display: flex; gap: 1rem;">
                            <input type="text" placeholder="ê²€ìƒ‰..." id="searchInput" 
                                   style="padding: 0.5rem; border: 1px solid #ccc; border-radius: 4px;"
                                   onkeyup="filterTable()">
                            <button class="btn btn-export" onclick="exportToExcel()">
                                ğŸ“¤ ì—‘ì…€ ë‚´ë³´ë‚´ê¸°
                            </button>
                        </div>
                    </div>
                    <div style="overflow-x: auto;">
                        <table class="data-table" id="dataTable">
                            <thead>
                                <tr>
                                    <th>ëŒ€ë¶„ë¥˜</th>
                                    <th>ì¤‘ë¶„ë¥˜</th>
                                    <th>ì†Œë¶„ë¥˜</th>
                                    <th>ê¸ˆí˜•ëª…</th>
                                    <th>ì›ê°€</th>
                                    <th>ìƒíƒœ</th>
                                    <th>ë“±ë¡ì¼</th>
                                    <th>ì‘ì—…</th>
                                </tr>
                            </thead>
                            <tbody id="tableBody">
                                <tr>
                                    <td colspan="8" style="text-align: center; padding: 2rem; color: #7f8c8d;">
                                        ë°ì´í„°ë¥¼ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let globalData = [];
        let filteredData = [];
        let charts = {};

        // íƒ­ ì „í™˜
        function switchTab(tabName) {
            // ëª¨ë“  íƒ­ ìˆ¨ê¸°ê¸°
            document.querySelectorAll('.tab-pane').forEach(pane => {
                pane.classList.remove('active');
            });
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // ì„ íƒí•œ íƒ­ ë³´ì´ê¸°
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');

            // ëŒ€ì‹œë³´ë“œ íƒ­ì¼ ë•Œ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
            if (tabName === 'dashboard' && globalData.length > 0) {
                setTimeout(updateDashboard, 100);
            }
        }

        // íŒŒì¼ ì—…ë¡œë“œ ì´ˆê¸°í™”
        function initializeUpload() {
            const uploadZone = document.getElementById('uploadZone');
            const fileInput = document.getElementById('fileInput');

            // ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì´ë²¤íŠ¸
            uploadZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadZone.classList.add('dragover');
            });

            uploadZone.addEventListener('dragleave', () => {
                uploadZone.classList.remove('dragover');
            });

            uploadZone.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadZone.classList.remove('dragover');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleFile(files[0]);
                }
            });

            // íŒŒì¼ ì„ íƒ ì´ë²¤íŠ¸
            fileInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    handleFile(e.target.files[0]);
                }
            });
        }

        // íŒŒì¼ ì²˜ë¦¬
        function handleFile(file) {
            if (!file.name.match(/\.(xlsx|xls)$/i)) {
                showAlert('Excel íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.', 'error');
                return;
            }

            showProgress(true);

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    processExcelData(e.target.result);
                } catch (error) {
                    showAlert('íŒŒì¼ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message, 'error');
                    showProgress(false);
                }
            };
            reader.readAsBinaryString(file);
        }

        // ì—‘ì…€ ë°ì´í„° ì²˜ë¦¬
        function processExcelData(data) {
            const workbook = XLSX.read(data, { type: 'binary' });
            const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
            const rows = XLSX.utils.sheet_to_json(firstSheet, { header: 1, defval: "" });

            if (rows.length < 2) {
                showAlert('ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.', 'error');
                showProgress(false);
                return;
            }

            // í—¤ë” í™•ì¸
            const headers = rows[0].map(h => String(h).trim());
            const requiredColumns = ['ëŒ€ë¶„ë¥˜', 'ì¤‘ë¶„ë¥˜', 'ì†Œë¶„ë¥˜', 'ê¸ˆí˜•ëª…', 'ì›ê°€', 'ìƒíƒœ', 'ë“±ë¡ì¼'];
            const columnIndexes = {};

            requiredColumns.forEach(col => {
                const index = headers.indexOf(col);
                if (index === -1) {
                    showAlert(`í•„ìˆ˜ ì»¬ëŸ¼ '${col}'ì´ ì—†ìŠµë‹ˆë‹¤.`, 'error');
                    showProgress(false);
                    return;
                }
                columnIndexes[col] = index;
            });

            // ë°ì´í„° íŒŒì‹±
            const parsedData = [];
            for (let i = 1; i < rows.length; i++) {
                const row = rows[i];
                if (!row[columnIndexes['ê¸ˆí˜•ëª…']] || !row[columnIndexes['ì›ê°€']]) continue;

                const costStr = String(row[columnIndexes['ì›ê°€']]).replace(/[^\d]/g, '');
                const cost = parseInt(costStr) || 0;

                parsedData.push({
                    id: Date.now() + i,
                    major: String(row[columnIndexes['ëŒ€ë¶„ë¥˜']] || ''),
                    middle: String(row[columnIndexes['ì¤‘ë¶„ë¥˜']] || ''),
                    minor: String(row[columnIndexes['ì†Œë¶„ë¥˜']] || ''),
                    moldName: String(row[columnIndexes['ê¸ˆí˜•ëª…']]),
                    cost: cost,
                    status: String(row[columnIndexes['ìƒíƒœ']] || 'ì •ìƒ'),
                    date: String(row[columnIndexes['ë“±ë¡ì¼']] || new Date().toISOString().split('T')[0])
                });
            }

            globalData = parsedData;
            filteredData = [...globalData];

            // ì§„í–‰ë¥  ì• ë‹ˆë©”ì´ì…˜
            animateProgress(() => {
                showAlert(`${parsedData.length}ê±´ì˜ ë°ì´í„°ê°€ ì„±ê³µì ìœ¼ë¡œ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!`, 'success');
                updateFilterOptions();
                updateTable();
                updateDashboard();
                showProgress(false);
            });
        }

        // ì§„í–‰ë¥  í‘œì‹œ
        function showProgress(show) {
            document.getElementById('progressContainer').style.display = show ? 'block' : 'none';
            if (!show) {
                document.getElementById('progressFill').style.width = '0%';
                document.getElementById('progressText').textContent = '0%';
            }
        }

        function animateProgress(callback) {
            let progress = 0;
            const interval = setInterval(() => {
                progress += Math.random() * 15;
                if (progress >= 100) {
                    progress = 100;
                    clearInterval(interval);
                    setTimeout(callback, 500);
                }
                document.getElementById('progressFill').style.width = progress + '%';
                document.getElementById('progressText').textContent = Math.round(progress) + '%';
            }, 100);
        }

        // ì•Œë¦¼ í‘œì‹œ
        function showAlert(message, type) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.innerHTML = `
                <span>${type === 'success' ? 'âœ…' : type === 'error' ? 'âŒ' : 'â„¹ï¸'}</span>
                <span>${message}</span>
            `;

            const result = document.getElementById('uploadResult');
            result.innerHTML = '';
            result.appendChild(alertDiv);

            setTimeout(() => {
                alertDiv.remove();
            }, 5000);
        }

        // í•„í„° ì˜µì…˜ ì—…ë°ì´íŠ¸
        function updateFilterOptions() {
            const majors = [...new Set(globalData.map(item => item.major))].filter(Boolean);
            const middles = [...new Set(globalData.map(item => item.middle))].filter(Boolean);
            const minors = [...new Set(globalData.map(item => item.minor))].filter(Boolean);

            updateSelectOptions('majorFilter', majors);
            updateSelectOptions('middleFilter', middles);
            updateSelectOptions('minorFilter', minors);
        }

        function updateSelectOptions(selectId, options) {
            const select = document.getElementById(selectId);
            const currentValue = select.value;
            select.innerHTML = '<option value="">ì „ì²´</option>';

            options.forEach(option => {
                const optionElement = document.createElement('option');
                optionElement.value = option;
                optionElement.textContent = option;
                select.appendChild(optionElement);
            });

            if (options.includes(currentValue)) {
                select.value = currentValue;
            }
        }

        // í•„í„° ì—…ë°ì´íŠ¸
        function updateFilters() {
            const majorFilter = document.getElementById('majorFilter').value;
            const middleFilter = document.getElementById('middleFilter').value;
            const minorFilter = document.getElementById('minorFilter').value;

            filteredData = globalData.filter(item => {
                return (!majorFilter || item.major === majorFilter) &&
                       (!middleFilter || item.middle === middleFilter) &&
                       (!minorFilter || item.minor === minorFilter);
            });

            updateTable();
            updateDashboard();
        }

        // í…Œì´ë¸” ì—…ë°ì´íŠ¸
        function updateTable() {
            const tbody = document.getElementById('tableBody');
            if (filteredData.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" style="text-align: center; padding: 2rem; color: #7f8c8d;">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</td></tr>';
                return;
            }

            tbody.innerHTML = filteredData.map(item => `
                <tr>
                    <td>${item.major}</td>
                    <td>${item.middle}</td>
                    <td>${item.minor}</td>
                    <td>${item.moldName}</td>
                    <td>â‚©${item.cost.toLocaleString()}ë§Œ</td>
                    <td><span class="status-badge ${getStatusClass(item.status)}">${item.status}</span></td>
                    <td>${item.date}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-edit" onclick="editItem(${item.id})">ìˆ˜ì •</button>
                            <button class="btn btn-delete" onclick="deleteItem(${item.id})">ì‚­ì œ</button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        function getStatusClass(status) {
            switch(status) {
                case 'ì •ìƒ': return 'status-normal';
                case 'ì´ˆê³¼': return 'status-danger';
                default: return 'status-warning';
            }
        }

        // ëŒ€ì‹œë³´ë“œ ì—…ë°ì´íŠ¸
        function updateDashboard() {
            if (filteredData.length === 0) return;

            // ìš”ì•½ í†µê³„ ê³„ì‚°
            const totalCost = filteredData.reduce((sum, item) => sum + item.cost, 0);
            const avgCost = totalCost / filteredData.length;
            const statusCount = filteredData.filter(item => item.status !== 'ì •ìƒ').length;

            document.getElementById('totalCost').textContent = 'â‚©' + totalCost.toLocaleString() + 'ë§Œ';
            document.getElementById('avgCost').textContent = 'â‚©' + Math.round(avgCost).toLocaleString() + 'ë§Œ';
            document.getElementById('totalCount').textContent = filteredData.length + 'ê±´';
            document.getElementById('statusCount').textContent = statusCount + 'ê±´';

            // ì°¨íŠ¸ ì—…ë°ì´íŠ¸
            updateCharts();
        }

        function updateCharts() {
            // ë¶„ë¥˜ë³„ ì›ê°€ ë¶„í¬ ì°¨íŠ¸
            const categoryData = {};
            filteredData.forEach(item => {
                const key = item.major || 'ê¸°íƒ€';
                categoryData[key] = (categoryData[key] || 0) + item.cost;
            });

            updateChart('categoryChart', 'doughnut', {
                labels: Object.keys(categoryData),
                datasets: [{
                    data: Object.values(categoryData),
                    backgroundColor: ['#3498db', '#2ecc71', '#f39c12', '#e74c3c', '#9b59b6']
                }]
            });

            // ë‚ ì§œë³„ íŠ¸ë Œë“œ ì°¨íŠ¸
            const trendData = {};
            filteredData.forEach(item => {
                const date = item.date || '2025-09-08';
                trendData[date] = (trendData[date] || 0) + item.cost;
            });

            const sortedDates = Object.keys(trendData).sort();
            updateChart('trendChart', 'line', {
                labels: sortedDates,
                datasets: [{
                    label: 'ì¼ë³„ ì›ê°€',
                    data: sortedDates.map(date => trendData[date]),
                    borderColor: '#3498db',
                    backgroundColor: 'rgba(52, 152, 219, 0.1)',
                    fill: true,
                    tension: 0.4
                }]
            });
        }

        function updateChart(canvasId, type, data) {
            const ctx = document.getElementById(canvasId).getContext('2d');

            if (charts[canvasId]) {
                charts[canvasId].destroy();
            }

            charts[canvasId] = new Chart(ctx, {
                type: type,
                data: data,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: type === 'doughnut' ? 'bottom' : 'top'
                        }
                    }
                }
            });
        }

        // í…Œì´ë¸” ê²€ìƒ‰
        function filterTable() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const rows = document.querySelectorAll('#tableBody tr');

            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }

        // ì—‘ì…€ ë‚´ë³´ë‚´ê¸°
        function exportToExcel() {
            if (filteredData.length === 0) {
                alert('ë‚´ë³´ë‚¼ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            const exportData = [
                ['ëŒ€ë¶„ë¥˜', 'ì¤‘ë¶„ë¥˜', 'ì†Œë¶„ë¥˜', 'ê¸ˆí˜•ëª…', 'ì›ê°€', 'ìƒíƒœ', 'ë“±ë¡ì¼']
            ];

            filteredData.forEach(item => {
                exportData.push([
                    item.major, item.middle, item.minor, item.moldName,
                    item.cost, item.status, item.date
                ]);
            });

            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.aoa_to_sheet(exportData);
            XLSX.utils.book_append_sheet(wb, ws, "ì›ê°€ë°ì´í„°");

            const fileName = `ì›ê°€ê´€ë¦¬ë°ì´í„°_${new Date().toISOString().split('T')[0]}.xlsx`;
            XLSX.writeFile(wb, fileName);
        }

        // ìƒ˜í”Œ íŒŒì¼ ë‹¤ìš´ë¡œë“œ
        function downloadSample() {
            const sampleData = [
                ['ëŒ€ë¶„ë¥˜', 'ì¤‘ë¶„ë¥˜', 'ì†Œë¶„ë¥˜', 'ê¸ˆí˜•ëª…', 'ì›ê°€', 'ìƒíƒœ', 'ë“±ë¡ì¼'],
                ['ê°€ê³µ', 'T0', 'ê¸°ë³¸ê°€ê³µ', 'ì‹œì‚¬ì¶œë¹„', '50', 'ì •ìƒ', '2025-09-08'],
                ['ì¬ë£Œ', 'T1', 'ì›ì¬ë£Œ', 'ë¶€ì¬ë£Œ', '5000', 'ê²€í† í•„ìš”', '2025-09-08'],
                ['ê°€ê³µ', 'T0', 'ì •ë°€ê°€ê³µ', 'T0-ê°€ê³µë¹„', '185', 'ì •ìƒ', '2025-09-04'],
                ['ì¬ë£Œ', 'T1', 'íŠ¹ìˆ˜ì¬ë£Œ', 'T1-ì›ì¬ë£Œ', '278', 'ê²€í† í•„ìš”', '2025-09-03']
            ];

            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.aoa_to_sheet(sampleData);
            XLSX.utils.book_append_sheet(wb, ws, "ìƒ˜í”Œë°ì´í„°");

            XLSX.writeFile(wb, "SCMS_ìƒ˜í”ŒíŒŒì¼.xlsx");
        }

        // ë°ì´í„° ìˆ˜ì •/ì‚­ì œ
        function editItem(id) {
            alert('ìˆ˜ì • ê¸°ëŠ¥ì€ ì¶”í›„ êµ¬í˜„ ì˜ˆì •ì…ë‹ˆë‹¤.');
        }

        function deleteItem(id) {
            if (confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                globalData = globalData.filter(item => item.id !== id);
                updateFilters();
            }
        }

        // í•„í„°ë§ëœ ë°ì´í„° ë‚´ë³´ë‚´ê¸°
        function exportFilteredData() {
            exportToExcel();
        }

        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            initializeUpload();
        });
    </script>
</body>
</html>
