
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>엑셀 기반 원가관리 시스템 - SCMS</title>
    <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1.5rem 2rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        }

        .header h1 {
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .header .subtitle {
            opacity: 0.9;
            font-size: 0.9rem;
            font-weight: 300;
        }

        .container {
            padding: 2rem;
            max-width: 1400px;
            margin: 0 auto;
        }

        /* 탭 네비게이션 */
        .nav-tabs {
            display: flex;
            background: white;
            border-radius: 12px 12px 0 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .nav-tab {
            flex: 1;
            padding: 1rem 2rem;
            background: #f8f9fa;
            border: none;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .nav-tab.active {
            background: white;
            color: #3498db;
            border-bottom: 3px solid #3498db;
        }

        .nav-tab:hover {
            background: #e9ecef;
        }

        /* 탭 콘텐츠 */
        .tab-content {
            background: white;
            border-radius: 0 0 12px 12px;
            box-shadow: 0 4px 25px rgba(0,0,0,0.08);
            min-height: 600px;
        }

        .tab-pane {
            display: none;
            padding: 2rem;
        }

        .tab-pane.active {
            display: block;
        }

        /* 업로드 영역 */
        .upload-zone {
            border: 3px dashed #3498db;
            border-radius: 12px;
            padding: 3rem 2rem;
            text-align: center;
            background: linear-gradient(135deg, #f8fcff 0%, #e3f2fd 100%);
            transition: all 0.3s ease;
            margin-bottom: 2rem;
        }

        .upload-zone.dragover {
            border-color: #2ecc71;
            background: linear-gradient(135deg, #f0fff4 0%, #e8f5e8 100%);
        }

        .upload-zone input[type="file"] {
            display: none;
        }

        .upload-btn {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            padding: 1rem 2rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 500;
            margin-top: 1rem;
            transition: all 0.3s ease;
        }

        .upload-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
        }

        /* 진행률 바 */
        .progress-container {
            margin: 1rem 0;
            display: none;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background-color: #ecf0f1;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #2ecc71);
            width: 0%;
            transition: width 0.3s ease;
        }

        /* 분류 필터 */
        .filter-section {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .filter-select {
            padding: 0.5rem 1rem;
            border: 2px solid #e1e8ed;
            border-radius: 6px;
            background: white;
            font-size: 0.9rem;
        }

        .filter-select:focus {
            outline: none;
            border-color: #3498db;
        }

        /* 요약 카드 */
        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .summary-card {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            border-left: 4px solid;
            transition: transform 0.3s ease;
        }

        .summary-card:hover {
            transform: translateY(-3px);
        }

        .summary-card.total { border-left-color: #3498db; }
        .summary-card.average { border-left-color: #2ecc71; }
        .summary-card.count { border-left-color: #f39c12; }
        .summary-card.status { border-left-color: #e74c3c; }

        .summary-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .summary-label {
            color: #7f8c8d;
            font-size: 0.9rem;
        }

        /* 차트 영역 */
        .chart-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .chart-container {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        }

        .chart-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: #2c3e50;
        }

        .chart-canvas {
            position: relative;
            height: 250px;
        }

        /* 데이터 테이블 */
        .table-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            overflow: hidden;
        }

        .table-header {
            background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%);
            color: white;
            padding: 1rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th,
        .data-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid #ecf0f1;
        }

        .data-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #2c3e50;
        }

        .data-table tr:hover {
            background: #f8f9fa;
        }

        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            white-space: nowrap;
        }

        .status-normal { background-color: #d4edda; color: #155724; }
        .status-warning { background-color: #fff3cd; color: #856404; }
        .status-danger { background-color: #f8d7da; color: #721c24; }

        /* 액션 버튼 */
        .action-buttons {
            display: flex;
            gap: 0.5rem;
        }

        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .btn-edit {
            background: #3498db;
            color: white;
        }

        .btn-delete {
            background: #e74c3c;
            color: white;
        }

        .btn-export {
            background: #2ecc71;
            color: white;
            padding: 0.75rem 1.5rem;
            font-weight: 500;
        }

        /* 알림 */
        .alert {
            padding: 1rem 1.5rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        /* 반응형 */
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            .chart-section {
                grid-template-columns: 1fr;
            }

            .summary-cards {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }

            .filter-section {
                flex-direction: column;
                align-items: stretch;
            }

            .nav-tabs {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>🏭 금형 원가관리 시스템 (SCMS)</h1>
        <div class="subtitle">Excel 기반 통합 원가관리 솔루션 - 에이치 에이 엔 테크</div>
    </div>

    <div class="container">
        <!-- 탭 네비게이션 -->
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('upload')">
                📊 데이터 업로드
            </button>
            <button class="nav-tab" onclick="switchTab('dashboard')">
                📈 대시보드
            </button>
            <button class="nav-tab" onclick="switchTab('list')">
                📋 데이터 목록
            </button>
        </div>

        <div class="tab-content">
            <!-- 데이터 업로드 탭 -->
            <div id="upload" class="tab-pane active">
                <h2 style="margin-bottom: 1.5rem;">📤 엑셀 파일 업로드</h2>

                <div class="alert alert-info">
                    <span>ℹ️</span>
                    <div>
                        <strong>업로드 가능한 파일:</strong> .xlsx, .xls 파일<br>
                        <strong>필수 컬럼:</strong> 대분류, 중분류, 소분류, 금형명, 원가, 상태, 등록일
                    </div>
                </div>

                <div class="upload-zone" id="uploadZone">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">📁</div>
                    <h3>파일을 여기에 드래그하거나 클릭하여 선택하세요</h3>
                    <p style="color: #7f8c8d; margin-top: 0.5rem;">
                        Excel 파일(.xlsx, .xls)만 업로드 가능합니다
                    </p>
                    <input type="file" id="fileInput" accept=".xlsx,.xls">
                    <button class="upload-btn" onclick="document.getElementById('fileInput').click()">
                        📂 파일 선택하기
                    </button>
                </div>

                <div class="progress-container" id="progressContainer">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                        <span>업로드 진행률</span>
                        <span id="progressText">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                </div>

                <div id="uploadResult"></div>

                <!-- 샘플 파일 다운로드 -->
                <div style="margin-top: 2rem; text-align: center;">
                    <button class="btn btn-export" onclick="downloadSample()">
                        📥 샘플 파일 다운로드
                    </button>
                </div>
            </div>

            <!-- 대시보드 탭 -->
            <div id="dashboard" class="tab-pane">
                <h2 style="margin-bottom: 1.5rem;">📊 원가 분석 대시보드</h2>

                <!-- 분류 필터 -->
                <div class="filter-section">
                    <div class="filter-group">
                        <label>대분류:</label>
                        <select class="filter-select" id="majorFilter" onchange="updateFilters()">
                            <option value="">전체</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>중분류:</label>
                        <select class="filter-select" id="middleFilter" onchange="updateFilters()">
                            <option value="">전체</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>소분류:</label>
                        <select class="filter-select" id="minorFilter" onchange="updateFilters()">
                            <option value="">전체</option>
                        </select>
                    </div>
                    <button class="btn btn-export" onclick="exportFilteredData()">
                        💾 현재 데이터 내보내기
                    </button>
                </div>

                <!-- 요약 카드 -->
                <div class="summary-cards">
                    <div class="summary-card total">
                        <div class="summary-value" id="totalCost">₩0</div>
                        <div class="summary-label">총 원가</div>
                    </div>
                    <div class="summary-card average">
                        <div class="summary-value" id="avgCost">₩0</div>
                        <div class="summary-label">평균 원가</div>
                    </div>
                    <div class="summary-card count">
                        <div class="summary-value" id="totalCount">0건</div>
                        <div class="summary-label">총 데이터 수</div>
                    </div>
                    <div class="summary-card status">
                        <div class="summary-value" id="statusCount">0건</div>
                        <div class="summary-label">검토 필요</div>
                    </div>
                </div>

                <!-- 차트 영역 -->
                <div class="chart-section">
                    <div class="chart-container">
                        <div class="chart-title">📊 분류별 원가 분포</div>
                        <div class="chart-canvas">
                            <canvas id="categoryChart"></canvas>
                        </div>
                    </div>
                    <div class="chart-container">
                        <div class="chart-title">📈 원가 트렌드</div>
                        <div class="chart-canvas">
                            <canvas id="trendChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 데이터 목록 탭 -->
            <div id="list" class="tab-pane">
                <div class="table-container">
                    <div class="table-header">
                        <h2>📋 원가 데이터 목록</h2>
                        <div style="display: flex; gap: 1rem;">
                            <input type="text" placeholder="검색..." id="searchInput" 
                                   style="padding: 0.5rem; border: 1px solid #ccc; border-radius: 4px;"
                                   onkeyup="filterTable()">
                            <button class="btn btn-export" onclick="exportToExcel()">
                                📤 엑셀 내보내기
                            </button>
                        </div>
                    </div>
                    <div style="overflow-x: auto;">
                        <table class="data-table" id="dataTable">
                            <thead>
                                <tr>
                                    <th>대분류</th>
                                    <th>중분류</th>
                                    <th>소분류</th>
                                    <th>금형명</th>
                                    <th>원가</th>
                                    <th>상태</th>
                                    <th>등록일</th>
                                    <th>작업</th>
                                </tr>
                            </thead>
                            <tbody id="tableBody">
                                <tr>
                                    <td colspan="8" style="text-align: center; padding: 2rem; color: #7f8c8d;">
                                        데이터를 업로드해주세요
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let globalData = [];
        let filteredData = [];
        let charts = {};

        // 탭 전환
        function switchTab(tabName) {
            // 모든 탭 숨기기
            document.querySelectorAll('.tab-pane').forEach(pane => {
                pane.classList.remove('active');
            });
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // 선택한 탭 보이기
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');

            // 대시보드 탭일 때 차트 업데이트
            if (tabName === 'dashboard' && globalData.length > 0) {
                setTimeout(updateDashboard, 100);
            }
        }

        // 파일 업로드 초기화
        function initializeUpload() {
            const uploadZone = document.getElementById('uploadZone');
            const fileInput = document.getElementById('fileInput');

            // 드래그 앤 드롭 이벤트
            uploadZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadZone.classList.add('dragover');
            });

            uploadZone.addEventListener('dragleave', () => {
                uploadZone.classList.remove('dragover');
            });

            uploadZone.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadZone.classList.remove('dragover');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleFile(files[0]);
                }
            });

            // 파일 선택 이벤트
            fileInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    handleFile(e.target.files[0]);
                }
            });
        }

        // 파일 처리
        function handleFile(file) {
            if (!file.name.match(/\.(xlsx|xls)$/i)) {
                showAlert('Excel 파일만 업로드 가능합니다.', 'error');
                return;
            }

            showProgress(true);

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    processExcelData(e.target.result);
                } catch (error) {
                    showAlert('파일 처리 중 오류가 발생했습니다: ' + error.message, 'error');
                    showProgress(false);
                }
            };
            reader.readAsBinaryString(file);
        }

        // 엑셀 데이터 처리
        function processExcelData(data) {
            const workbook = XLSX.read(data, { type: 'binary' });
            const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
            const rows = XLSX.utils.sheet_to_json(firstSheet, { header: 1, defval: "" });

            if (rows.length < 2) {
                showAlert('데이터가 없습니다.', 'error');
                showProgress(false);
                return;
            }

            // 헤더 확인
            const headers = rows[0].map(h => String(h).trim());
            const requiredColumns = ['대분류', '중분류', '소분류', '금형명', '원가', '상태', '등록일'];
            const columnIndexes = {};

            requiredColumns.forEach(col => {
                const index = headers.indexOf(col);
                if (index === -1) {
                    showAlert(`필수 컬럼 '${col}'이 없습니다.`, 'error');
                    showProgress(false);
                    return;
                }
                columnIndexes[col] = index;
            });

            // 데이터 파싱
            const parsedData = [];
            for (let i = 1; i < rows.length; i++) {
                const row = rows[i];
                if (!row[columnIndexes['금형명']] || !row[columnIndexes['원가']]) continue;

                const costStr = String(row[columnIndexes['원가']]).replace(/[^\d]/g, '');
                const cost = parseInt(costStr) || 0;

                parsedData.push({
                    id: Date.now() + i,
                    major: String(row[columnIndexes['대분류']] || ''),
                    middle: String(row[columnIndexes['중분류']] || ''),
                    minor: String(row[columnIndexes['소분류']] || ''),
                    moldName: String(row[columnIndexes['금형명']]),
                    cost: cost,
                    status: String(row[columnIndexes['상태']] || '정상'),
                    date: String(row[columnIndexes['등록일']] || new Date().toISOString().split('T')[0])
                });
            }

            globalData = parsedData;
            filteredData = [...globalData];

            // 진행률 애니메이션
            animateProgress(() => {
                showAlert(`${parsedData.length}건의 데이터가 성공적으로 업로드되었습니다!`, 'success');
                updateFilterOptions();
                updateTable();
                updateDashboard();
                showProgress(false);
            });
        }

        // 진행률 표시
        function showProgress(show) {
            document.getElementById('progressContainer').style.display = show ? 'block' : 'none';
            if (!show) {
                document.getElementById('progressFill').style.width = '0%';
                document.getElementById('progressText').textContent = '0%';
            }
        }

        function animateProgress(callback) {
            let progress = 0;
            const interval = setInterval(() => {
                progress += Math.random() * 15;
                if (progress >= 100) {
                    progress = 100;
                    clearInterval(interval);
                    setTimeout(callback, 500);
                }
                document.getElementById('progressFill').style.width = progress + '%';
                document.getElementById('progressText').textContent = Math.round(progress) + '%';
            }, 100);
        }

        // 알림 표시
        function showAlert(message, type) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.innerHTML = `
                <span>${type === 'success' ? '✅' : type === 'error' ? '❌' : 'ℹ️'}</span>
                <span>${message}</span>
            `;

            const result = document.getElementById('uploadResult');
            result.innerHTML = '';
            result.appendChild(alertDiv);

            setTimeout(() => {
                alertDiv.remove();
            }, 5000);
        }

        // 필터 옵션 업데이트
        function updateFilterOptions() {
            const majors = [...new Set(globalData.map(item => item.major))].filter(Boolean);
            const middles = [...new Set(globalData.map(item => item.middle))].filter(Boolean);
            const minors = [...new Set(globalData.map(item => item.minor))].filter(Boolean);

            updateSelectOptions('majorFilter', majors);
            updateSelectOptions('middleFilter', middles);
            updateSelectOptions('minorFilter', minors);
        }

        function updateSelectOptions(selectId, options) {
            const select = document.getElementById(selectId);
            const currentValue = select.value;
            select.innerHTML = '<option value="">전체</option>';

            options.forEach(option => {
                const optionElement = document.createElement('option');
                optionElement.value = option;
                optionElement.textContent = option;
                select.appendChild(optionElement);
            });

            if (options.includes(currentValue)) {
                select.value = currentValue;
            }
        }

        // 필터 업데이트
        function updateFilters() {
            const majorFilter = document.getElementById('majorFilter').value;
            const middleFilter = document.getElementById('middleFilter').value;
            const minorFilter = document.getElementById('minorFilter').value;

            filteredData = globalData.filter(item => {
                return (!majorFilter || item.major === majorFilter) &&
                       (!middleFilter || item.middle === middleFilter) &&
                       (!minorFilter || item.minor === minorFilter);
            });

            updateTable();
            updateDashboard();
        }

        // 테이블 업데이트
        function updateTable() {
            const tbody = document.getElementById('tableBody');
            if (filteredData.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" style="text-align: center; padding: 2rem; color: #7f8c8d;">데이터가 없습니다</td></tr>';
                return;
            }

            tbody.innerHTML = filteredData.map(item => `
                <tr>
                    <td>${item.major}</td>
                    <td>${item.middle}</td>
                    <td>${item.minor}</td>
                    <td>${item.moldName}</td>
                    <td>₩${item.cost.toLocaleString()}만</td>
                    <td><span class="status-badge ${getStatusClass(item.status)}">${item.status}</span></td>
                    <td>${item.date}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-edit" onclick="editItem(${item.id})">수정</button>
                            <button class="btn btn-delete" onclick="deleteItem(${item.id})">삭제</button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        function getStatusClass(status) {
            switch(status) {
                case '정상': return 'status-normal';
                case '초과': return 'status-danger';
                default: return 'status-warning';
            }
        }

        // 대시보드 업데이트
        function updateDashboard() {
            if (filteredData.length === 0) return;

            // 요약 통계 계산
            const totalCost = filteredData.reduce((sum, item) => sum + item.cost, 0);
            const avgCost = totalCost / filteredData.length;
            const statusCount = filteredData.filter(item => item.status !== '정상').length;

            document.getElementById('totalCost').textContent = '₩' + totalCost.toLocaleString() + '만';
            document.getElementById('avgCost').textContent = '₩' + Math.round(avgCost).toLocaleString() + '만';
            document.getElementById('totalCount').textContent = filteredData.length + '건';
            document.getElementById('statusCount').textContent = statusCount + '건';

            // 차트 업데이트
            updateCharts();
        }

        function updateCharts() {
            // 분류별 원가 분포 차트
            const categoryData = {};
            filteredData.forEach(item => {
                const key = item.major || '기타';
                categoryData[key] = (categoryData[key] || 0) + item.cost;
            });

            updateChart('categoryChart', 'doughnut', {
                labels: Object.keys(categoryData),
                datasets: [{
                    data: Object.values(categoryData),
                    backgroundColor: ['#3498db', '#2ecc71', '#f39c12', '#e74c3c', '#9b59b6']
                }]
            });

            // 날짜별 트렌드 차트
            const trendData = {};
            filteredData.forEach(item => {
                const date = item.date || '2025-09-08';
                trendData[date] = (trendData[date] || 0) + item.cost;
            });

            const sortedDates = Object.keys(trendData).sort();
            updateChart('trendChart', 'line', {
                labels: sortedDates,
                datasets: [{
                    label: '일별 원가',
                    data: sortedDates.map(date => trendData[date]),
                    borderColor: '#3498db',
                    backgroundColor: 'rgba(52, 152, 219, 0.1)',
                    fill: true,
                    tension: 0.4
                }]
            });
        }

        function updateChart(canvasId, type, data) {
            const ctx = document.getElementById(canvasId).getContext('2d');

            if (charts[canvasId]) {
                charts[canvasId].destroy();
            }

            charts[canvasId] = new Chart(ctx, {
                type: type,
                data: data,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: type === 'doughnut' ? 'bottom' : 'top'
                        }
                    }
                }
            });
        }

        // 테이블 검색
        function filterTable() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const rows = document.querySelectorAll('#tableBody tr');

            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }

        // 엑셀 내보내기
        function exportToExcel() {
            if (filteredData.length === 0) {
                alert('내보낼 데이터가 없습니다.');
                return;
            }

            const exportData = [
                ['대분류', '중분류', '소분류', '금형명', '원가', '상태', '등록일']
            ];

            filteredData.forEach(item => {
                exportData.push([
                    item.major, item.middle, item.minor, item.moldName,
                    item.cost, item.status, item.date
                ]);
            });

            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.aoa_to_sheet(exportData);
            XLSX.utils.book_append_sheet(wb, ws, "원가데이터");

            const fileName = `원가관리데이터_${new Date().toISOString().split('T')[0]}.xlsx`;
            XLSX.writeFile(wb, fileName);
        }

        // 샘플 파일 다운로드
        function downloadSample() {
            const sampleData = [
                ['대분류', '중분류', '소분류', '금형명', '원가', '상태', '등록일'],
                ['가공', 'T0', '기본가공', '시사출비', '50', '정상', '2025-09-08'],
                ['재료', 'T1', '원재료', '부재료', '5000', '검토필요', '2025-09-08'],
                ['가공', 'T0', '정밀가공', 'T0-가공비', '185', '정상', '2025-09-04'],
                ['재료', 'T1', '특수재료', 'T1-원재료', '278', '검토필요', '2025-09-03']
            ];

            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.aoa_to_sheet(sampleData);
            XLSX.utils.book_append_sheet(wb, ws, "샘플데이터");

            XLSX.writeFile(wb, "SCMS_샘플파일.xlsx");
        }

        // 데이터 수정/삭제
        function editItem(id) {
            alert('수정 기능은 추후 구현 예정입니다.');
        }

        function deleteItem(id) {
            if (confirm('정말 삭제하시겠습니까?')) {
                globalData = globalData.filter(item => item.id !== id);
                updateFilters();
            }
        }

        // 필터링된 데이터 내보내기
        function exportFilteredData() {
            exportToExcel();
        }

        // 초기화
        document.addEventListener('DOMContentLoaded', function() {
            initializeUpload();
        });
    </script>
</body>
</html>
